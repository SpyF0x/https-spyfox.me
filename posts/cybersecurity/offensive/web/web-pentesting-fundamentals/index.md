# Web pentesting - Fundamentals


The objective of a web pentest is to evaluate the security of web application by simulating a cyberattack.

## A little bit of context
---
The auditor's job can be separated into two main activities: identifying vulnerabilities (Vulnerability Assessment) and using them to perform a full penetration test (Pentest).

Companies may request the services of an auditor only to run a Nessus (or OpenVAS) scan on an IP address range, without authorizing an actual intrusion.

Here is an important point in the penetration testing process: what is allowed ?

When defining the audit perimeter, the company have to define the limits imposed on the tester.

Let's now take a look at the different methodologies on how to conduct an intrusion test.

## Defining the point of view
### Black Box

Probably the most exciting for an auditor because he is in the exact same position as a "real" hacker.

The test is performed from an external network, without knowing the architecture.

The tester will therefore have to go through a reconnaissance stage to map all the possible equipments as well as any other useful information.
### White box

The auditor is in the position of a malicious employee: he knows the composition of the network and the systems installed.

The reconnaissance step is simplified but the auditor will still have to list :

- Installed software and their versions
- The different sub-networks
- The available logins
- etc.
### Grey box

This is a combination of the two previous ones. The auditor puts himself in the shoes of an ex-employee: he knows the composition of the network and the systems installed, but the test must be performed from an external network.

Once again, the reconnaissance stage is simplified. However, the intrusion phase remains as delicate as in the case of a black box.

## Performing reconnaissance

All the major cyberattacks begins with a reconnaissance step. It should take about 75% of the whole operation time.

The more you rush this step, the more likely you are to be detected or to see your attack fail.

Also, as part of a security audit, this step provides a comprehensive list of all the vulnerabilities in a network.
### Passive reconnaissance

Certainly the least risky step in a cyberattack, and unless you are engaged in some terrorist activities, there is no chance you would be blamed for this type of reconnaissance.

It's all about getting any publicly available information. All sources are good to go:

- Use a tool like nmap to enumerate running services : 
{{< figure src="/images/security/web-pentest/web-pentest1.png" alt="web pentest" >}} 
- Clone the official website (using HTTrack for example) to analyze it offline.
- Use Google (and Google dorks) to list the sub-domains associated with a domain name.
- List all virtual hosts associated with the IP address of the web server.
- Directory listings : 
{{< figure src="/images/security/web-pentest/web-pentest2.png" alt="web pentest" >}} 
- etc.
### Active reconnaissance

Several open source tools are perfect to automate some of this step : 

- The classical dirb to bruteforce directories and its derivatives (gobuster, wfuzz, etc.) :
{{< figure src="/images/security/web-pentest/web-pentest7.png" alt="web pentest" >}} 
- Subscraper to enumerate the subdomains using dns :
{{< figure src="/images/security/web-pentest/web-pentest3.png" alt="web pentest" >}} 
- WPScan if WordPress based website : 
{{< figure src="/images/security/web-pentest/web-pentest8.png" alt="web pentest" >}} 
- SQLmap to play around the database: 
{{< figure src="/images/security/web-pentest/web-pentest9.png" alt="web pentest" >}} 

Note that obtaining valid accounts naturally allows an attacker to extend his attack surface by giving him access to more functionalities and hence to more vulnerabilities.
### Detecting vulnerabilities

If you have listed the technologies used on the website, as well as their versions, you can search the Internet for known vulnerabilities in these configurations.

If you are suicidal (or if the company does not have an intrusion detection system), you can use tools like Nessus or w3af (wich is a Nessus-like scanner for the web) to search for vulnerabilities on the website.

{{< figure src="/images/security/web-pentest/web-pentest3.jpg" alt="web pentest" >}} 

## Planning the actions

In order to take the least possible risk during the operation, you should perform several recaps before this step: the first one right after the passive reconnaissance, to minimize the risks during the active reconnaissance, and the second one after the active reconnaissance, to target the vulnerability detection.

Once you have a good amount of the flaws being listed, you must plan the attack:

- Define precisely the attack plan.
- Define which web servers will be targeted and in which order.
- Define which tools and methods will be used and how.
- Develop specific tools for the attack.
- Modify, if necessary, existing tools to better fit your needs.
- List the targets of social engineering attacks and define a precise scenario (have it validated by the company that requested the audit).
- Plan the steps following the intrusion (privileges escalation, maintaining access and cleaning up).

{{< figure src="/images/security/web-pentest/web-pentest5.jpg" alt="web pentest" >}} 

In a black box audit, you may have to work in an iterative way, moving through the audited infrastructure bit by bit.

Indeed, you won't have a global vision of the infrastructure until you set foot on it.

You will therefore have to start all over again with each step.

## Attacking and cracking up the perimeter

Finally, here is the step that is most talked about: the exploitation of the flaws in order to obtain access (in other words, pop a shell).

The goal here, is to apply our plan and adapt it to any unexpected situation.

## Getting more privileges

With all the information obtained in the previous recognition steps, you should have a rough idea of how to get the highest possible permissions, but don't worry ! Once you have breached into the system, it is quite normal to feel like you are starting from scratch. 

You have to enumerate (again) the different services and software that may be running to find vulnerabilities and exploit them in order to get those precious administrator (SYSTEM or root) permissions.

All means are good to achieve that :

- Operating system vulnerabilities
- Buffer overflows
- Vulnerable softwares
- Password attacks
- Social engineering
- etc.

## Maintaining access

As part of the audit, you may have to place a backdoor. Don't forget to use robust software to secure access ! 

You don't want a truly malicious hacker to take advantage of your audit to gain access to the servers !

{{< figure src="/images/security/web-pentest/web-pentest4.png" alt="web pentest" >}} 


## Cleaning up

Throughout the audit, you must save every data you altered, and keep a trace of every modification applied to the system to restore to its original state.

It is unacceptable for a security audit to create security holes !

You should also erase the intrusion traces by clearing log files and deleting any data you created to gain access.

## Make a detailed report

The audited company is interested in the precise process used by the intruder to gain entry, as well as the data recovered during the reconnaissance.

Everything should be recorded, from the smallest piece of information gathered to the tools and plan used for the intrusion.

The report should obviously contain recommendations for securing the web application.

{{< figure src="/images/security/web-pentest/web-pentest6.jpg" alt="web pentest" >}} 

To sum up, the job of an IT security auditor is more complex than the job of a black hat in the way that he must record everything he does, make a backup of the altered data. He must also keep in mind the objective and write a comprehensive report about how to secure the web app / servers.

Contrary to black hats, not all means are good enough for a pentester to achieve his goals. 

Social engineering, if not prohibited, will be for instance highly supervised. The perimeter would be precisely defined as well as the exploitation methods (XSS / SQL injections, CSRF, etc.).

## Make a good action !
---
Hit that `CTRL + D` to bookmark this website üîñ

Internet is for sharing, so please consider sharing this post if you liked it !

It will be so much better than any newsletter #privacy #spam #planet üåç ‚ù§Ô∏è
