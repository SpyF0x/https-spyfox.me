<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta http-equiv=x-ua-compatible content="IE=edge, chrome=1"><title>Void Linux w/ encrypted boot, rootfs and swap on BIOS - ~# SpyF0x_</title><meta name=Description content="So today, we will see how to properly set up an uncomplicated Void Linux full disk encryption installation on legacy BIOS."><meta property="og:title" content="Void Linux w/ encrypted boot, rootfs and swap on BIOS"><meta property="og:description" content="So today, we will see how to properly set up an uncomplicated Void Linux full disk encryption installation on legacy BIOS."><meta property="og:type" content="article"><meta property="og:url" content="https://spyfox.me/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/"><meta property="og:image" content="https://spyfox.me/logo.png"><meta property="article:published_time" content="2022-01-01T12:00:00+00:00"><meta property="article:modified_time" content="2022-01-01T12:00:00+00:00"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://spyfox.me/logo.png"><meta name=twitter:title content="Void Linux w/ encrypted boot, rootfs and swap on BIOS"><meta name=twitter:description content="So today, we will see how to properly set up an uncomplicated Void Linux full disk encryption installation on legacy BIOS."><meta name=application-name content="~# SpyF0x_"><meta name=apple-mobile-web-app-title content="~# SpyF0x_"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://spyfox.me/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/><link rel=prev href=https://spyfox.me/posts/cybersecurity/protection/system/how-to-block-log4j-with-fail2ban/><link rel=next href=https://spyfox.me/posts/cybersecurity/protection/system/secure-your-gnu-linux-server-with-these-few-iptables-rules/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Void Linux w/ encrypted boot, rootfs and swap on BIOS","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/spyfox.me\/posts\/system\/linux\/tutorials\/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-\/"},"image":["https:\/\/spyfox.me\/images\/Apple-Devices-Preview.png"],"genre":"posts","keywords":"Void Linux, distro, encrypt","wordcount":1592,"url":"https:\/\/spyfox.me\/posts\/system\/linux\/tutorials\/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-\/","datePublished":"2022-01-01T12:00:00+00:00","dateModified":"2022-01-01T12:00:00+00:00","publisher":{"@type":"Organization","name":"SpyF0x","logo":"https:\/\/spyfox.me\/images\/avatar.png"},"author":{"@type":"Person","name":" SpyF0x "},"description":"So today, we will see how to properly set up an uncomplicated Void Linux full disk encryption installation on legacy BIOS."}</script></head><body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'auto'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'auto'==='dark')&&document.body.setAttribute('theme','dark')</script><div id=mask></div><div class=wrapper><header class=desktop id=header-desktop><div class=header-wrapper><div class=header-title><a href=/ title="~# SpyF0x_"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/avatar.png data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" data-sizes=auto alt=/images/avatar.png title=/images/avatar.png>~# SpyF0x_</a></div><div class=menu><div class=menu-inner><a class=menu-item href=/posts/>Posts </a><a class=menu-item href=/tags/>Tags </a><a class=menu-item href=/categories/>Categories </a><a class=menu-item href=/posts/about>About </a><a class=menu-item href=/posts/contact><i class="far fa-envelope fa-fw"></i> </a><a class=menu-item href=/index.xml><i class="fas fa-rss fa-fw"></i> </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-desktop><i class="fas fa-spinner fa-fw fa-spin"></i></span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme"><i class="fas fa-adjust fa-fw"></i></a></div></div></div></header><header class=mobile id=header-mobile><div class=header-container><div class=header-wrapper><div class=header-title><a href=/ title="~# SpyF0x_"><img class="lazyload logo" src=/svg/loading.min.svg data-src=/images/avatar.png data-srcset="/images/avatar.png, /images/avatar.png 1.5x, /images/avatar.png 2x" data-sizes=auto alt=/images/avatar.png title=/images/avatar.png>~# SpyF0x_</a></div><div class=menu-toggle id=menu-toggle-mobile><span></span><span></span><span></span></div></div><div class=menu id=menu-mobile><div class=search-wrapper><div class="search mobile" id=search-mobile><input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search><i class="fas fa-search fa-fw"></i></a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear><i class="fas fa-times-circle fa-fw"></i></a>
<span class="search-button search-loading" id=search-loading-mobile><i class="fas fa-spinner fa-fw fa-spin"></i></span></div><a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>Cancel</a></div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a class=menu-item href=/posts/about title>About</a><a class=menu-item href=/posts/contact title><i class="far fa-envelope fa-fw"></i></a><a class=menu-item href=/index.xml title><i class="fas fa-rss fa-fw"></i></a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i></a></div></div></header><div class="search-dropdown desktop"><div id=search-dropdown-desktop></div></div><div class="search-dropdown mobile"><div id=search-dropdown-mobile></div></div><main class=main><div class=container><div class=toc id=toc-auto><h2 class=toc-title>Contents</h2><div class=toc-content id=toc-content-auto></div></div><article class="page single"><h1 class="single-title animated flipInX">Void Linux w/ encrypted boot, rootfs and swap on BIOS</h1><div class=post-meta><div class=post-meta-line><span class=post-author><a href=/ title=Author rel=" author" class=author><i class="fas fa-user-circle fa-fw"></i> SpyF0x </a></span>&nbsp;<span class=post-category>included in <a href=/categories/system/><i class="far fa-folder fa-fw"></i>System</a></span></div><div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-01-01>2022-01-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1592 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div></div><div class=featured-image><img class=lazyload src=/svg/loading.min.svg data-src=/images/tutorials/void/encrypted-void0.webp data-srcset="/images/tutorials/void/encrypted-void0.webp, /images/tutorials/void/encrypted-void0.webp 1.5x, /images/tutorials/void/encrypted-void0.webp 2x" data-sizes=auto alt=/images/tutorials/void/encrypted-void0.webp title="So today, we will see how to properly set up an uncomplicated Void Linux full disk encryption installation on legacy BIOS."></div><div class="details toc" id=toc-static kept><div class="details-summary toc-title"><span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span></div><div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents><ul><li><a href=#first-things-first>First things first</a></li><li><a href=#preparation>Preparation</a></li><li><a href=#installation>Installation</a><ul><li><a href=#set-your-key-map>Set your key map</a></li><li><a href=#set-your-wi-fi>Set your Wi-Fi</a><ul><li><ul><li><a href=#set-up-partitions-mbr>Set up partitions (MBR)</a></li></ul></li></ul></li><li><a href=#format-the-partition-luks--ext4>Format the partition (LUKS + EXT4)</a></li><li><a href=#prepare-the-chroot->Prepare the chroot :</a></li><li><a href=#pacstrap-bootstrap-void-linux->Pacstrap Bootstrap Void Linux !</a></li><li><a href=#set-up-the-new-system>Set up the new system</a></li><li><a href=#initramfs-encryption>Initramfs encryption</a></li><li><a href=#crypttab-set-up>Crypttab set up</a></li><li><a href=#grub-set-up>GRUB set up</a></li></ul></li><li><a href=#endgame>Endgame</a><ul><li><a href=#network-service>Network service</a></li><li><a href=#user-creation>User creation</a></li><li><a href=#swap-creation>Swap creation</a></li></ul></li><li><a href=#make-a-good-action->Make a good action !</a></li></ul></nav></div></div><div class=content id=content><p>So today, we will see how to properly set up an uncomplicated Void Linux full disk encryption installation on legacy BIOS.</p><h2 id=first-things-first>First things first</h2><hr><p>In case you&rsquo;re wondering :</p><blockquote><p><strong>1. <em>Why Void Linux ?</em></strong></p></blockquote><p>I&rsquo;ve recently acquired an old laptop, so what&rsquo;s better for this old boi than an ultra lightweight <em>systemd free</em> GNU/Linux distribution ?</p><blockquote><p><strong><em>2. Why encrypted ?</em></strong></p></blockquote><p>It&rsquo;s a <em>(bad ?)</em> habit I got from work.</p><p>Moreover, in those shady times where privacy has become a distant memory from the past, it&rsquo;s always good to properly encrypt your storage.</p><blockquote><p><strong><em>3. Why encrypt boot and swap as well ?</em></strong></p></blockquote><p>Encrypting your boot sectors will keep you away from evil maid attacks, while encrypting your swap will ensure that no one will never recover any plaintext information from your computer.</p><p>In my opinion, you should not be using any swap or at least an encrypted one but never ever use an unencrypted swap !</p><blockquote><p><strong><em>4. You said BIOS ?</em></strong></p></blockquote><p>BIOS is awesome to do an uncomplicated real full disk encryption. Moreover, it is compatible with nearly any existing computer at the opposite of bloated next generation UEFI.</p><h2 id=preparation>Preparation</h2><hr><p>Obtain the latest Void Linux live ISO from the official <a href=https://voidlinux.org/download/ target=_blank rel="noopener noreffer">website</a>.</p><figure><img src=/images/tutorials/void/encrypted-void1.png alt="denial of service attack"></figure><p>Unless you know what you are doing, choose glibc live xfce (&lt;900 Mb) or glibc live base image (&lt;600 Mb).</p><p>Of course, I strongly recommended you to validate the integrity and authenticity of any downloaded image before using it, to ensure it hasn’t been tampered.</p><p><em>Note: Void Linux devs provide you some instructions on how to do so in the <a href=https://docs.voidlinux.org/installation/index.html#verifying-images target=_blank rel="noopener noreffer">Void Handbook</a></em></p><p>Once everything is downloaded and verified, connect your USB stick and ask politely dd to do the work for you :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># sudo dd bs=4M if=[IMAGE.ISO] of=/dev/sdX status=progress
</code></pre></td></tr></table></div></div><p>Once the image has been written onto the USB stick, turn on the target computer (or reboot it) and boot from your USB stick.</p><p>If you don&rsquo;t know how to do that, please consider searching a bit online, as it strongly depends on your hardware.</p><h2 id=installation>Installation</h2><hr><p>Once Void Linux live is up and running, open up a bash shell and get comfy !</p><h3 id=set-your-key-map>Set your key map</h3><p>Xfce : <code>$ setxkbmap [Country Code]</code></p><p>base : <code>$ loadkeys [Country Code]</code></p><h3 id=set-your-wi-fi>Set your Wi-Fi</h3><p>Do the installation over Ethernet, but if somehow you really can&rsquo;t, here&rsquo;s how to set up Wi-Fi :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># cp /etc/wpa_supplicant/wpa_supplicant.conf /etc/wpa_supplicant/wpa_supplicant-&lt;wlan-interface&gt;.conf

# wpa_passphrase &lt;ssid&gt; &lt;passphrase&gt; &gt;&gt; /etc/wpa_supplicant/wpa_supplicant-&lt;wlan-interface&gt;.conf

# sv restart dhcpcd
# ip link set up &lt;interface&gt;
</code></pre></td></tr></table></div></div><h5 id=set-up-partitions-mbr>Set up partitions (MBR)</h5><p>First, tell your disk to use an MBR table :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># parted /dev/sdX mklabel msdos
</code></pre></td></tr></table></div></div><p>Then create a single partition : primary partition, bootable flag, 100% size</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># cfdisk /dev/sdX
</code></pre></td></tr></table></div></div><h3 id=format-the-partition-luks--ext4>Format the partition (LUKS + EXT4)</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># cryptset up luksFormat --type luks1 /dev/sdX1
</code></pre></td></tr></table></div></div><p><em>Note: By default, LUKS will be using <code>"--type luks2"</code> wich still has some bugs with GRUB 2.06</em></p><p>Next, open it and create the filesystem. Old good EXT4 is my choice, but you can use any filesystem you want :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># cryptset up open /dev/sdX1 cryptroot
# mkfs.ext4 cryptroot -q 
</code></pre></td></tr></table></div></div><p><em>Note: <code>-q</code> means &ldquo;quiet&rdquo;. It&rsquo;s just a personal preference</em></p><h3 id=prepare-the-chroot->Prepare the chroot :</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># mount /dev/mapper/cryptroot /mnt
# mkdir /mnt/dev /mnt/proc /mnt/sys
# mount --rbind /dev /mnt/dev
# mount --rbind /proc /mnt/proc
# mount --rbind /sys /mnt/sys
</code></pre></td></tr></table></div></div><h3 id=pacstrap-bootstrap-void-linux-><del>Pacstrap</del> Bootstrap Void Linux !</h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># xbps-install -Sy -R https://repo-us.voidlinux.org/ -r /mnt base-system cryptset up grub nano
</code></pre></td></tr></table></div></div><h3 id=set-up-the-new-system>Set up the new system</h3><p>Chroot into your hard drive :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># chroot /mnt /bin/bash
</code></pre></td></tr></table></div></div><p>Then change the root password / default shell :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># passwd
# chsh -s /bin/bash
</code></pre></td></tr></table></div></div><p>Configure your timezone and your locales :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># echo LANG=en_US.UTF-8 &gt; /etc/locale.conf
# echo &#34;en_US.UTF-8 UTF-8&#34; &gt;&gt; /etc/default/libc-locales
# xbps-reconfigure -f glibc-locales
</code></pre></td></tr></table></div></div><p>And finally change your hostname accordingly to your preferences :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># echo &lt;hostname&gt; &gt; /etc/hostname
</code></pre></td></tr></table></div></div><h3 id=initramfs-encryption>Initramfs encryption</h3><p>When your computer will be booting up, Grub will ask you to enter a password.</p><p>It will be used to decrypt the initramfs but once done, you&rsquo;ll need to enter a second password in order to unlock rootfs.</p><p>To avoid that, we will be using a tiny hack consisting of making a key file generated with /dev/urandom :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># dd bs=512 count=4 if=/dev/random of=/crypt.keyfile
# chmod 000 /crypt.keyfile
</code></pre></td></tr></table></div></div><p>Create a variable where we will be storing our partition&rsquo;s UUID :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># uuid=$(sudo blkid -o value -s UUID /dev/sdX1)
dac4bfae-5172-463c-b9b5-6418e01c2f74
# cryptset up -v luksAddKey $uuid /crypt.keyfile
</code></pre></td></tr></table></div></div><p>Apply proper permissions to /boot :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># chmod -R g-rwx,o-rwx /boot
</code></pre></td></tr></table></div></div><h3 id=crypttab-set-up>Crypttab set up</h3><p>This will echo the UUID value of /dev/sdx1 to your crypttab :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># echo $uuid &gt;&gt; /etc/crypttab
</code></pre></td></tr></table></div></div><p>Once you have your UUID written in crypttab, just edit the file, so you have something similar to this at the end of the file :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>cryptroot UUID=dac4bfae-5172-463c-b9b5-6418e01c2f74 /crypt.keyfile luks
</code></pre></td></tr></table></div></div><p>Finally, edit Dracut :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># vim /etc/dracut.conf.d/10-crypt.conf
install_items+=&#34; /crypt.keyfile /etc/crypttab &#34;
</code></pre></td></tr></table></div></div><p><em>Note: Keep the <strong>SAME</strong> syntax with surrounding whitespaces !</em></p><h3 id=grub-set-up>GRUB set up</h3><p>Redirect again your UUID :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># echo $uuid &gt;&gt; /etc/default/grub
</code></pre></td></tr></table></div></div><p>And edit Grub config file to include those lines :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>GRUB_CMDLINE_LINUX=&#34;cryptdevice=UUID=dac4bfae-5172-463c-b9b5-6418e01c2f74:cryptroot&#34;
GRUB_ENABLE_CRYPTODISK=y
</code></pre></td></tr></table></div></div><p>As well as &ldquo;rd.auto=1&rdquo; to GRUB_CMDLINE_LINUX_DEFAULT to force autoassembly of LUKS device :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback>GRUB_CMDLINE_LINUX_DEFAULT=&#34;loglevel=4 slub_debug=P page_poison=1 rd.auto=1&#34;
</code></pre></td></tr></table></div></div><p>Finally, the most critical step of this whole process, install Grub :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># grub-install --recheck /dev/sdX
# grub-mkconfig -o /boot/grub/grub.cfg
# xbps-reconfigure -fa
</code></pre></td></tr></table></div></div><p><em>Note: if the previous grub-install command has failed, try to force BIOS targeting with this :</em></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># grub-install --target=i386-pc --no-floppy --recheck /dev/sdX
</code></pre></td></tr></table></div></div><p>If you used some Wi-Fi during this installation, it might be useful to copy it over to the new install :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># cp /etc/wpa_supplicant/wpa_supplicant.conf /mnt/etc/wpa_supplicant/wpa_supplicant.conf
</code></pre></td></tr></table></div></div><p>Finally, reboot !</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># exit
# umount -R /mnt
# reboot
</code></pre></td></tr></table></div></div><p>Once reboot done, you should be prompted by GRUB for the password. Once the system is finished booting, log in.</p><p>You can now set up network services, users, and install additional packages&mldr;</p><h2 id=endgame>Endgame</h2><hr><figure><img src=/images/tutorials/void/encrypted-void2.jpg alt="denial of service attack"></figure><h3 id=network-service>Network service</h3><p>Dhcpcd package is included in the base-system, so don&rsquo;t worry, you&rsquo;re not trapped !</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># ln -s /etc/sv/dhcpcd /var/service/
</code></pre></td></tr></table></div></div><p>This will automatically start the service. Once a service is linked, it will always start on boot and restart if it stops.</p><p>If you need to keep an enabled service from starting automatically at boot, create a file named &ldquo;down&rdquo; in the service directory like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># touch /etc/sv/service_name/down
</code></pre></td></tr></table></div></div><h3 id=user-creation>User creation</h3><p>Then we&rsquo;ll add a normal user (called &ldquo;user&rdquo; in this example) and add him to the wheel group :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># useradd -m -g wheel -s /bin/bash user
# passwd user
</code></pre></td></tr></table></div></div><p>I also like to install the chrony daemon to keep clock in sync and socklog for logging and to enable ACPI events:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># xbps-install -Su
# xbps-install chrony socklog-void
# ln -s /etc/sv/chronyd /var/service/
# ln -s /etc/sv/socklog-unix /var/service/
# ln -s /etc/sv/nanoklogd /var/service/
# ln -s /etc/sv/acpid /var/service
</code></pre></td></tr></table></div></div><p>You probably also won&rsquo;t need all the six running tty&rsquo;s, so you can remove some of them from <code>/var/service/</code>.</p><p>Then it&rsquo;s time to set up the relevant entries to the <code>/etc/hosts</code> file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># vim /etc/hosts
127.0.0.1        localhost
::1              localhost
127.0.1.1        myhostname.localdomain myhostname
</code></pre></td></tr></table></div></div><h3 id=swap-creation>Swap creation</h3><p>The last step is to create a swap file (if you want that). If you don&rsquo;t know how much should be your swap, don&rsquo;t worry !</p><p>Different people have a different opinion on ideal swap size. Even the major Linux distributions don’t have the same swap size guideline.</p><p>If you go by Red Hat’s <a href=https://www.redhat.com/en/blog/do-we-really-need-swap-modern-systems target=_blank rel="noopener noreffer">suggestion</a>, they recommend a swap size of 20% of RAM for modern systems (i.e. 4 GB or higher RAM).</p><p>CentOS has a different <a href=https://docs.centos.org/5/html/Deployment_Guide-en-US/ch-swapspace.html target=_blank rel="noopener noreffer">recommendation</a> for the swap partition size. It suggests swap size to be:</p><pre><code>&gt; Twice the size of RAM if RAM is less than 2 GB
&gt; Size of RAM + 2 GB if RAM size is more than 2 GB i.e. 5 GB of swap for 3 GB of RAM
</code></pre><p>Ubuntu has an entirely different perspective on the swap size as it takes hibernation into consideration. If you require hibernation, a swap of the size of RAM becomes necessary for Ubuntu.</p><p>Otherwise, it recommends:</p><pre><code>&gt; If RAM is less than 1 GB, swap size should be at least the size of RAM and at most double the size of RAM

&gt; If RAM is more than 1 GB, swap size should be at least equal to the square root of the RAM size and at most double the size of RAM

&gt; If hibernation is used, swap size should be equal to the size of RAM plus the square root of the RAM size
</code></pre><p>Anyway, to create a swap file the size of your choosing simply use dd (here 4 GB):</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># dd if=/dev/zero of=/swapfile bs=1M count=4096 status=progress
</code></pre></td></tr></table></div></div><p>Set the right permissions:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># chmod 600 /swapfile
</code></pre></td></tr></table></div></div><p>Format the file to swap:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># mkswap /swapfile
</code></pre></td></tr></table></div></div><p>Activate the swap file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># swapon /swapfile
</code></pre></td></tr></table></div></div><p>Finally, edit the /etc/fstab configuration to add an entry for the swap file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># vim /etc/fstab
/swapfile none swap defaults 0 0
</code></pre></td></tr></table></div></div><p>You can check that the swapfile is up and running with:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-fallback data-lang=fallback># free
</code></pre></td></tr></table></div></div><h2 id=make-a-good-action->Make a good action !</h2><hr><p>Hit that <code>CTRL + D</code> to bookmark this website 🔖</p><p>Internet is for sharing, so please consider sharing this post if you liked it !</p><p>It will be so much better than any newsletter #privacy #spam #planet 🌍 ❤️</p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>Updated on 2022-01-01</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/index.md target=_blank>Read Markdown</a></span></div><div class=post-info-share><span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://spyfox.me/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/ data-title="Void Linux w/ encrypted boot, rootfs and swap on BIOS" data-hashtags="Void Linux,distro,encrypt"><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://spyfox.me/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/ data-hashtag="Void Linux"><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on Linkedin" data-sharer=linkedin data-url=https://spyfox.me/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/><i class="fab fa-linkedin fa-fw"></i></a><a href=javascript:void(0); title="Share on Reddit" data-sharer=reddit data-url=https://spyfox.me/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/><i class="fab fa-reddit fa-fw"></i></a><a href=javascript:void(0); title="Share on VK" data-sharer=vk data-url=https://spyfox.me/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/ data-title="Void Linux w/ encrypted boot, rootfs and swap on BIOS" data-caption="So today, we will see how to properly set up an uncomplicated Void Linux full disk encryption installation on legacy BIOS." data-image=/images/tutorials/void/encrypted-void0.webp><i class="fab fa-vk fa-fw"></i></a><a href=javascript:void(0); title="Share on Pocket" data-sharer=pocket data-url=https://spyfox.me/posts/system/linux/tutorials/void-linux-with-encrypted-boot-rootfs-and-swap-on-bios-/><i class="fab fa-get-pocket fa-fw"></i></a></span></div></div></div><div class=post-info-more><section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/void-linux/>Void Linux</a>,&nbsp;<a href=/tags/distro/>distro</a>,&nbsp;<a href=/tags/encrypt/>encrypt</a></section><section><span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span></section></div><div class=post-nav><a href=/posts/cybersecurity/protection/system/how-to-block-log4j-with-fail2ban/ class=prev rel=prev title="How to block Log4j with fail2ban"><i class="fas fa-angle-left fa-fw"></i>How to block Log4j with fail2ban</a>
<a href=/posts/cybersecurity/protection/system/secure-your-gnu-linux-server-with-these-few-iptables-rules/ class=next rel=next title="Secure your GNU/Linux server with these few iptables rules">Secure your GNU/Linux server with these few iptables rules<i class="fas fa-angle-right fa-fw"></i></a></div></div></article></div></main><footer class=footer><div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2019 - 2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank> SpyF0x </a></span>&nbsp;|&nbsp;<span class=license><a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc-nd/4.0/ target=_blank>CC BY-NC-ND 4.0</a></span></div></div></footer></div><div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top"><i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments"><i class="fas fa-comment fa-fw"></i></a></div><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:50},comment:{},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body></html>